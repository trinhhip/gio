<?php
/* @var OmnyfyCustomzation\Vendor\Block\Vendor\Listing $block */

$vendorList = $block->getVendorList()
?>
<?php if (!count($vendorList)): ?>
    <div class="message info empty">
        <div>
            <?= __('We can\'t find vendor matching the selection.') ?>
        </div>
    </div>
<?php else: ?>
    <!-- Custom Pagination -->
    <div class="products wrapper grid products-grid">
        <ol id="vendor-list" class="products list items product-items">
            <?php foreach ($vendorList as $alphabet => $vendors): ?>
                <div class="vendor">
                    <div class="filter-character" data-role="trigger">
                        <span class="character"><?= $alphabet ?></span>
                        <span class="character-count">(<?= count($vendors) . ' Designer' ?>)</span>
                    </div>
                    <div class="character-vendor-content" data-role="content">
                        <?php foreach ($vendors as $vendor): ?>
                            <li class="item product product-item">
                                <div class="product-item-info" data-container="product-grid">
                                    <?php $vendorLogo = $block->getLogoUrl($vendor); ?>
                                    <a class="product photo product-item-photo" href="<?= $block->getVendorUrl($vendor) ?>"
                                       tabindex="-1">
                                        <?php if (!empty($vendorLogo)) : ?>
                                            <img src="<?= $vendorLogo ?>" alt="<?php echo __($vendor->getName()); ?>"/>
                                        <?php endif; ?>
                                    </a>
                                    <div class="product details product-item-details">
                                        <strong class="product name product-item-name">
                                            <a class="product-item-link" href="<?= $block->getVendorUrl($vendor) ?>">
                                                <?= $vendor->getName(); ?>
                                            </a>
                                        </strong>
                                        <span class="vendor-address"><?= $vendor->getAddress(); ?></span>
                                        <div class="product-item-inner">
                                            <div class="product description product-item-description">
                                                <?= $vendor->getDescription() ?>
                                            </div>
                                            <a href="<?= $block->getVendorUrl($vendor) ?>"
                                               title="<?= $vendor->getName() ?>"
                                               class="action more">
                                                <?= __('View creator') ?>
                                            </a>
                                        </div>
                                        <?php $productsOfVendor = $block->getProductByVendor($vendor); ?>
                                        <?php if ($productsOfVendor->count()): ?>
                                            <div class="products-vendor-item owl-carousel owl-theme">
                                                <?php foreach ($productsOfVendor as $product): ?>
                                                    <div class="product-vendor">
                                                        <a href="<?= $product->getProductUrl() ?>">
                                                            <img src="<?= $block->getProductImage($product) ?>" alt="">
                                                        </a>
                                                    </div>
                                                <?php endforeach; ?>
                                            </div>
                                        <?php endif; ?>
                                    </div>
                                </div>
                            </li>
                        <?php endforeach; ?>
                    </div>
                </div>
            <?php endforeach; ?>
        </ol>
    </div>
<?php endif; ?>

<script type="text/javascript">
    require([
        'jquery',
        'owl.carousel/owl.carousel.min',
        'mage/collapsible'
    ], function ($) {
        $(".products-vendor-item").owlCarousel({
            navRewind: true,
            margin: 15,
            nav: true,
            navText: ["<i class='far fa-long-arrow-left'></i>","<i class='far fa-long-arrow-right'></i>"],
            dots: false,
            responsive: {
                0: {
                    items: 0
                },
                375: {
                    items: 2
                },
                768: {
                    items:2
                },
                992: {
                    items:3
                },
                1200: {
                    items:4
                }
            }
        });

        $(".vendor").collapsible(
            { "header": ".filter-character", "openedState": "active", "active": true }
        );
    });
</script>
